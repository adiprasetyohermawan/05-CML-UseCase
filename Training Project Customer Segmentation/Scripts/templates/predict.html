<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Customer Segmentation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/predict.css" />
  </head>
  <body>
    <!-- Side Bar -->
    <div
      id="sidebar"
      class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark"
      style="width: 280px"
    >
      <a
        href="/"
        class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none"
        ><span class="fs-4">Menu</span>
      </a>
      <hr />
      <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a
            href="#"
            class="nav-link text-white"
            onclick="showSection('visualization-section')"
            aria-current="page"
            >Customer Cluster Visualization & Analysis</a
          >
        </li>
        <li class="nav-item">
          <a
            href="#"
            class="nav-link text-white"
            onclick="showSection('prediction-section')"
            aria-current="page"
            >New Data Prediction Form
          </a>
        </li>
      </ul>
      <hr />
    </div>

    <div id="main-content">
      <h1 class="display-4 fw-bold">Customer Segmentation</h1>
      <!-- Home Section -->
      <div id="home-section">
        <img
          src="..\static\customer-segmentation.JPG"
          class="img-fluid border rounded-3 shadow-lg mb-4"
          alt="Example image"
          width="700"
          height="500"
          loading="lazy"
        />
        <blockquote class="blockquote mt-4">
          <p class="mb-0">
            "Understanding your customers is the foundation of effective
            strategy. Through segmentation, we transform data into insights,
            enabling us to meet unique needs, foster loyalty, and drive growth."
          </p>
        </blockquote>
        <div id="visualization" class="mt-3"></div>
      </div>

      <!-- Visualization Section -->
      <div id="visualization-section" style="display: none">
        <div class="container">
          <h1 class="mt-5">Cluster Visualization</h1>

          <div class="form-group mt-4">
            <label for="clusterSelect">Choose Cluster:</label>
            <select
              id="clusterSelect"
              class="form-control"
              onchange="loadClusterData()"
            >
              <option value="" disabled selected>Select a cluster</option>
              <option value="0">Cluster 0</option>
              <option value="1">Cluster 1</option>
              <option value="2">Cluster 2</option>
              <option value="3">Cluster 3</option>
            </select>
          </div>

          <!-- Summary Table -->
          <div id="summaryTable" class="summary-table"></div>

          <!-- Histogram Visualization -->
          <div id="histogramImage" class="histogram-image"></div>

          <div id="encodingNotesContainer" style="display: none">
            <!-- Button to Open Feature Encoding Notes Modal -->
            <button
              type="button"
              class="btn btn-info mt-4"
              data-bs-toggle="modal"
              data-bs-target="#encodingNotesModal"
            >
              View Feature Encoding Notes
            </button>

            <!-- Feature Encoding Notes Modal -->
            <div
              class="modal fade"
              id="encodingNotesModal"
              tabindex="-1"
              aria-labelledby="encodingNotesModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="encodingNotesModalLabel">
                      Feature Encoding Notes
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                          <th>Feature</th>
                          <th>Category</th>
                          <th>Encoded Value</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- DOB Age Interval Encoding -->
                        <tr>
                          <td rowspan="9">DOB (Age Interval)</td>
                          <td>19-22</td>
                          <td>1</td>
                        </tr>
                        <tr>
                          <td>23-26</td>
                          <td>2</td>
                        </tr>
                        <tr>
                          <td>27-30</td>
                          <td>3</td>
                        </tr>
                        <tr>
                          <td>31-34</td>
                          <td>4</td>
                        </tr>
                        <tr>
                          <td>35-38</td>
                          <td>5</td>
                        </tr>
                        <tr>
                          <td>39-42</td>
                          <td>6</td>
                        </tr>
                        <tr>
                          <td>43-46</td>
                          <td>7</td>
                        </tr>
                        <tr>
                          <td>47-50</td>
                          <td>8</td>
                        </tr>
                        <tr>
                          <td>51-54</td>
                          <td>9</td>
                        </tr>

                        <!-- Bank ID Encoding -->
                        <tr>
                          <td rowspan="7">Bank ID</td>
                          <td>BRI (002)</td>
                          <td>1</td>
                        </tr>
                        <tr>
                          <td>Bank Mandiri (008)</td>
                          <td>2</td>
                        </tr>
                        <tr>
                          <td>BNI (009)</td>
                          <td>3</td>
                        </tr>
                        <tr>
                          <td>Bank Danamon (011)</td>
                          <td>4</td>
                        </tr>
                        <tr>
                          <td>Bank Permata (013)</td>
                          <td>5</td>
                        </tr>
                        <tr>
                          <td>BCA (014)</td>
                          <td>6</td>
                        </tr>
                        <tr>
                          <td>Bank CIMB Niaga (022)</td>
                          <td>7</td>
                        </tr>

                        <!-- City Encoding -->
                        <tr>
                          <td rowspan="5">City</td>
                          <td>Bandung</td>
                          <td>1</td>
                        </tr>
                        <tr>
                          <td>Jakarta</td>
                          <td>2</td>
                        </tr>
                        <tr>
                          <td>Medan</td>
                          <td>3</td>
                        </tr>
                        <tr>
                          <td>Semarang</td>
                          <td>4</td>
                        </tr>
                        <tr>
                          <td>Surabaya</td>
                          <td>5</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Interpretation Summary Section -->
            <div id="interpretationSummary" class="interpretation-summary mt-4">
              <h3 id="clusterTitle"></h3>
              <div id="clusterSections"></div>
              <p id="clusterSummary" class="mt-3"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Prediction Form Section -->
      <div id="prediction-section" style="display: none">
        <h2>Predict Customer Cluster</h2>
        <form id="predict-form" class="mt-4">
          <div class="mb-3 form-group was-validated">
            <label for="dob" class="form-label">Age</label>
            <input
              type="number"
              class="form-control"
              id="dob"
              placeholder="e.g., 25, 30, etc"
              required
            />
            <div class="invalid-feedback">Please input a valid age</div>
          </div>
          <div class="mb-3 form-group was-validated">
            <label for="bank_id" class="form-label">Bank ID</label>
            <select
              class="custom-select form-control"
              id="bank_id"
              name="bank_id"
              required
            >
              <option value="">Choose...</option>
              <option value="002">BRI</option>
              <option value="008">Bank Mandiri</option>
              <option value="009">BNI</option>
              <option value="011">Bank Danamon</option>
              <option value="013">Bank Permata</option>
              <option value="014">BCA</option>
              <option value="022">Bank CIMB Niaga</option>
            </select>
            <div class="invalid-feedback">Please select a valid bank</div>
            <!-- <input
              type="text"
              class="form-control"
              id="bank_id"
              placeholder="e.g., 022"
              required
            /> -->
          </div>
          <div class="mb-3 form-group was-validated">
            <label for="city" class="form-label">City</label>
            <select
              class="form-control custom-select"
              id="city"
              name="city"
              required
            >
              <option value="">Choose...</option>
              <option value="Bandung">Bandung</option>
              <option value="Jakarta">Jakarta</option>
              <option value="Medan">Medan</option>
              <option value="Semarang">Semarang</option>
              <option value="Surabaya">Surabaya</option>
            </select>
            <div class="invalid-feedback">Please select a valid city</div>
            <!-- <input
              type="text"
              class="form-control"
              id="city"
              placeholder="e.g., Jakarta"
              required
            /> -->
          </div>
          <div class="mb-3 form-group was-validated">
            <label for="total_transaction" class="form-label"
              >Total Transaction</label
            >
            <input
              type="text"
              class="form-control"
              id="total_transaction"
              placeholder="e.g., 12500000"
              required
              oninput="formatInputValue(this, 'totalTransactionRaw')"
            />
            <div class="invalid-feedback">
              Enter the total transaction amount here. Please use the correct
              format (e.g., 12500000).
            </div>
          </div>
          <div class="mb-3 form-group was-validated">
            <label for="income" class="form-label">Income</label>
            <input
              type="text"
              class="form-control"
              id="income"
              placeholder="e.g., 5000000"
              required
              oninput="formatInputValue(this, 'incomeRaw')"
            />
            <div class="invalid-feedback">
              Enter the income amount here. Please use the correct format (e.g.,
              5000000).
            </div>
          </div>
          <!-- Hidden inputs to store unformatted values -->
          <input type="hidden" id="totalTransactionRaw" />
          <input type="hidden" id="incomeRaw" />
          <button
            type="button"
            class="btn btn-primary"
            id="predictButton"
            onclick="submitPrediction()"
          >
            Predict Cluster
          </button>
        </form>
        <div id="prediction-result" class="mt-3"></div>
        <!-- div for test result -->
        <!-- <div id="test-result" class="mt-3"></div> -->
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../static/js/predict.js"></script>
  </body>
</html>
