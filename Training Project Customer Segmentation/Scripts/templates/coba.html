<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Customer Segmentation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body {
        display: flex;
      }
      #sidebar {
        width: 200px;
        padding: 20px;
        background-color: #f8f9fa;
        height: 100vh;
        border-right: 1px solid #ddd;
      }
      #main-content {
        flex: 1;
        padding: 20px;
      }
    </style>
  </head>
  <body>
    <div id="sidebar">
      <h3>Options</h3>
      <button
        class="btn btn-outline-primary w-100 mb-2"
        onclick="showSection('visualization-section')"
      >
        Visualization Section
      </button>
      <button
        class="btn btn-outline-primary w-100"
        onclick="showSection('prediction-section')"
      >
        Prediction Form
      </button>
    </div>

    <div id="main-content">
      <h1>Customer Segmentation</h1>

      <!-- Visualization Section -->
      <div id="visualization-section" style="display: none">
        <h2>Visualize Customer Clusters</h2>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Cluster</th>
              <th>Count</th>
              <th>Avg Income</th>
              <th>Avg Transaction</th>
            </tr>
          </thead>
          <tbody>
            {% for cluster, summary in cluster_summary.items() %}
            <tr>
              <td>{{ cluster }}</td>
              <td>{{ summary["Count"] }}</td>
              <td>{{ summary["Avg Income"] }}</td>
              <td>{{ summary["Avg Transaction"] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <button onclick="fetchVisualization()" class="btn btn-primary">
          Show Histogram
        </button>
        <div id="visualization" class="mt-3"></div>
      </div>

      <!-- Prediction Form Section -->
      <div id="prediction-section" style="display: none">
        <h2>Predict Customer Cluster</h2>
        <form id="predict-form">
          <div class="mb-3">
            <label for="age" class="form-label">Age</label>
            <input type="number" class="form-control" id="age" required />
          </div>
          <div class="mb-3">
            <label for="bank_id" class="form-label">Bank ID</label>
            <input type="number" class="form-control" id="bank_id" required />
          </div>
          <div class="mb-3">
            <label for="city" class="form-label">City</label>
            <input type="number" class="form-control" id="city" required />
          </div>
          <div class="mb-3">
            <label for="total_transaction" class="form-label"
              >Total Transaction</label
            >
            <input
              type="number"
              class="form-control"
              id="total_transaction"
              required
            />
          </div>
          <div class="mb-3">
            <label for="income" class="form-label">Income</label>
            <input type="number" class="form-control" id="income" required />
          </div>
          <button
            type="button"
            class="btn btn-primary"
            onclick="submitPrediction()"
          >
            Predict Cluster
          </button>
        </form>
        <div id="prediction-result" class="mt-3"></div>
      </div>
    </div>

    <script>
      // Function to toggle sections
      function showSection(sectionId) {
        document.getElementById("visualization-section").style.display = "none";
        document.getElementById("prediction-section").style.display = "none";
        document.getElementById(sectionId).style.display = "block";
      }

      function fetchVisualization() {
        axios
          .get("/visualize_clusters")
          .then((response) => {
            const img_data = response.data.img_data;
            document.getElementById(
              "visualization"
            ).innerHTML = `<img src="data:image/png;base64,${img_data}" alt="Cluster Visualization"/>`;
          })
          .catch((error) => console.error(error));
      }

      function submitPrediction() {
        const data = {
          age: document.getElementById("age").value,
          bank_id: document.getElementById("bank_id").value,
          city: document.getElementById("city").value,
          total_transaction: document.getElementById("total_transaction").value,
          income: document.getElementById("income").value,
        };

        axios
          .post("/predict", data)
          .then((response) => {
            const result = response.data;
            document.getElementById(
              "prediction-result"
            ).innerHTML = `<p>Cluster: ${result.cluster}</p><p>${result.interpretation}</p>`;
          })
          .catch((error) => console.error(error));
      }
    </script>
  </body>
</html>
